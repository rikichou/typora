# QR分解

## 1. 相关知识-正交矩阵（orthogonal matrix）

矩阵的列都是单位向量且互相正交。

正交矩阵有很多好的性质，比如：
$$
Q^TQ = I
\tag{1}
$$
如果Q是一个方阵，那么其转置就等于其逆
$$
Q^t = Q^{-1}
\tag{1}
$$
$$

$$

此时投影矩阵也会变得简单
$$
P = Q(Q^TQ)^{-1}Q^{T}=QQ^T
\tag{2}
$$
如果Q是方阵的话，投影将进一步化简为
$$
P = I
$$

## 2. 相关知识-Gram-Schmidt正交化

消元法的目的是得到一个三角矩阵，二GS正交化的目的是将矩阵的列向量标准正交化。

假设有两个线性无关的向量，a和b，目的是得到两个向量A和B，使得A垂直B。

首先A=a，B就是b减去b在A上的投影(b减去平行于A的分量，剩下的就是垂直于A的分量)
$$
A = a
\tag{3}
$$

$$
B = b - \frac{A^Tb}{A^TA}A
\tag{4}
$$

如果还有另一个向量c，想要求得C，使其垂直于A和B，那么就是c减去c在A中的分量以及c在B中的分量。
$$
C = c - \frac{A^Tc}{A^TA}A - \frac{B^Tc}{B^TB}B
\tag{5}
$$
然后求的的ABC向量分别除以向量的长度将其变为标准正交向量

所以这是求解一组线性无关向量的标准正交基？

[a, b]以及[A, B]所表示的列空间是相等的，因为以上的所有操作都是在[a,b]所表示的列空间内的。



## 3. QR分解

### 3.1 什么是QR分解?

就是将矩阵A分解成一个正交矩阵Q以及上三角矩阵R。分解的方式也很简单，首先根据上一节说的Gram-Schmidt方法将矩阵A转换为正交矩阵Q，使得Q的列向量都是单位正交向量。
$$
A = QR
\tag{6}
$$
现在已知A和Q，为了求得R，将Q移到另一边
$$
Q^{-1}A = R = Q^{T}A
\tag{7}
$$
这样就可以求得R，求出来的R是一个上三角矩阵，因为根据Gram-Schmidt方法可以得知，A中的每一列，都是由当前的q以及之前的q来组成（具体看书上说明），和之后的单位正交向量物管。

## 3.2 为什么要进行QR分解？

将A分解为正交矩阵Q（此Q可能不是方阵，但是其列向量都是单位正交的，这里先统称正交矩阵）之后，使得Q具有一些比较好的性质。

#### 3.2.1 投影

我们知道投影矩阵的表示如下
$$
P = A(A^TA)^{-1}A^T
\tag{8}
$$
此时的A的列空间的投影矩阵就如公式8表示。

如果现在求得A的列空间的一组基，表示为Q，Q的列向量是单位正交的。所以此时的投影矩阵可以表示为
$$
P = A(A^TA)^{-1}A^T=Q(Q^TQ)^{-1}Q^T
\tag{9}
$$
根据公式1的性质可知
$$
P = QQ^T
$$
此时的投影矩阵里面没有了求逆的操作，运算变得更简单。

#### 3.2.2 最小二乘

在解线性方程组Ax=b的时候，经常会发现无解，也就是b不在A的列空间里面。所以使用最小二乘来进行求解
$$
A^TA\widehat{x} = A^Tb
$$

$$
\widehat{x} = (A^TA)^{-1}A^Tb
\tag{10}
$$

此时，如果将A=QR带入以上公式，可以将其化简
$$
A^TA = (QR)^TQR = R^TQ^TQR = R^TR
$$

$$
A^Tb = (QR)^Tb = R^TQ^Tb
$$

$$
R^TR\widehat{x} = R^TQ^Tb
$$

$$
R\widehat{x} = Q^Tb
\tag{11}
$$

公式11就是求解x的最终形式，可以看出，公式里面不再包含求逆操作，并且R是上三角矩阵，所以求解x只需进行若干的回带就可以了

#### 3.2.3 求逆

课程的练习代码eigen库的使用中有提到使用QR分解求逆的速度要比直接求逆的速度更快，原因如下
$$
A^{-1} = (QR)^{-1} = R^{-1}Q^{-1} = R^{-1}Q^T
$$
因为R是上三角矩阵，求逆的开销会更小，所以比A直接求逆更快



## 4. QR分解总结

综上所述QR分解主要用于加速相关矩阵运算，比如求逆和投影等操作，具体在SLAM中有什么作用还需要看接下来的课程。





